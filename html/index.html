<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>neos sessions</title>
        <style>
            body { margin: 0; }
            div#contents { display: flex; flex-wrap: wrap; }
            .alt { background-color: #333333;}
        </style>
        <link rel="stylesheet" href="css/sessionIcon.css">
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r127/three.min.js"></script> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r127/three.js"></script>
        <script src="js/neos_common.js"></script>
        <script src="js/panorama.js"></script>
        <script src="js/sessionIcon.js"></script>
    </head>
    <body>
        <div id="contents"></div>
        <script>
            const contents = document.getElementById("contents");
            const alt = document.createElement("div");
            alt.classList.add("alt");
            var sessionIcons = [];
            var panoramaLoads = [];
            var panoramaLoader = () => {
                requestAnimationFrame(panoramaLoader);
                if(panoramaLoads.length > 0){
                    if(2>(PanoramaPreview.ActiveWebGLClasses)){
                        panoramaLoads.pop().panorama_load();
                    }
                }
            };
            panoramaLoader();
            const io = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.load();
                    }
                });
            });

            fetch('/sessions.json')
                .then((response) => response.json())
                .then((data) => {
                    data.forEach(e => {
                        const sessionIcon = new SessionIcon(contents, e, alt);
                        io.observe(sessionIcon.domElement);
                        sessionIcon.domElement.load = () => {
                            panoramaLoads.push(sessionIcon);
                        };
                    });
                });
            
        </script>
    </body>
</html>