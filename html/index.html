<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>simple panorama</title>
        <style>
            body { margin: 0; }
            #main_canvas{ width: 512px; height: 400px; }
        </style>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r127/three.min.js"></script>
        <script src="js/panorama.js"></script>
    </head>
    <body>
        <canvas id="main_canvas"></canvas>
        <script>
            const main_canvas = document.getElementById("main_canvas");
            pano = new PanoramaPreview(main_canvas);
            pano.loadImage("img.webp").then(()=>{
                pano.enable();
            });
            px = 0;
            tx = 0;
            ty = 0;
            main_canvas.onmousemove = function(event){
                const x = event.offsetX/main_canvas.clientWidth-0.5;
                const y = event.offsetY/main_canvas.clientHeight-0.5;
                tx = -x*1.95;
                ty = -y*1.95;
            }
            main_canvas.onmouseout = function(event){
                tx = ty = 0;
            }
            pano.beforeRender = (dt) => {
                const alpha = 0.08;
                pano.pitch = pano.pitch*(1-alpha) + ty*alpha;
                pano.yaw -= px;
                px = px*(1-alpha) + tx*alpha;
                pano.yaw += 1*dt+px;
            }
        </script>
    </body>
</html>